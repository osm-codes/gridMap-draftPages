function changeLevel_byDigits(e){let t=document.getElementById("fielddecode").value;t.length>0?e>0?(document.getElementById("fielddecode").value=t.replace(/[^0-9a-f]$/,"")+"7",getDecode()):e<0&&t.length>1?(document.getElementById("fielddecode").value=t.substring(0,t.length-1),getDecode()):alert("Check code or level limits"):alert("Click a point first.")}function generateSelectGrid(e){let t="",o="";for(let l=0;l<e.length;l++)t+='<option value="grid'+e[l]+'">'+e[l]+" grid</option>",o+='<option value="grid'+(e[l]+1)+'">'+e[l]+" points</option>";return'<option value="">Cell</option>'+t+o}function generateSelectLevel(e,t=0,o=0){let l="",r=0,i=1,a=0;1==o?(i=2,a=1):2==o?(i=2,a=0):4==o?(i=4,a=0):5==o?(i=5,a=0):51==o&&(i=5,a=1);const n=e.endLevel;for(let e=0;e<=n;e++){if(e%i!==a)continue;r=e%4==0?e/4+1:Math.floor(e/4)+2;const o=Math.pow(2,n-e),c=Math.sqrt(o),s=Math.round(111*c)/100;l+=`<option value="${s}"${t<=s?" selected":""}>L${e} (${r}d) (${c<1e3?Math.round(100*c)/100+"m":Math.round(100*c/1e3)/100+"km"}) ${e%2==0?"&#9643;":"&#9645;"}</option>`}return l}function geoURI_to_geohackString(e){const t=e.match(/^\s*geo:(?:[a-zA-Z_][a-zA-Z_0-9]+:)?(\-?[0-9\.]+),(\-?[0-9\.]+)$/i);return latd=t[1],lond=t[2],""!=latd&&(sign=latd>0?1:-1,lat4=latd>0?"N":"S",latd*=sign,lat1=Math.floor(latd),lat2=Math.floor(60*(latd-lat1)),lat3=Math.floor(3600*(latd-lat1-lat2/60))),""!=lond&&(sign=lond>0?1:-1,lon4=lond>0?"E":"W",lond*=sign,lon1=Math.floor(lond),lon2=Math.floor(60*(lond-lon1)),lon3=Math.floor(3600*(lond-lon1-lon2/60))),p=lat1+"_"+lat2+"_"+lat3+"_"+lat4+"_",p+=lon1+"_"+lon2+"_"+lon3+"_"+lon4,p}function go_to_geohackString(){const e=document.getElementById("geoUri").innerHTML;if(console.log(e),null===e||""===e)alert("Error: click the map.");else{const t="https://geohack.toolforge.org/geohack.php?params=",o=geoURI_to_geohackString(e.split(";u=")[0]);window.open(t+o,"_blank").focus()}}function sortAndRemoveDuplicates(e){return[...new Set(e.trim().split(/[\n,]+/).map((e=>e.trim().substring(0,11))))].sort().join(",")}function fixZOrder(e){Object.keys(e).forEach((function(t){var o=e[t];o._layers&&Object.keys(o._layers).length>0&&o._layers[Object.keys(o._layers)[0]]._path&&o._layers[Object.keys(o._layers)[0]]._path.parentNode&&o.bringToFront()}))}function latRound(e){return Number.parseFloat(e).toFixed(6)}var defaultMap,defaultMapBase,toggleTooltipStatus=!1,toggleCoverStatus=!1,isLogAfaCodeAbs=!1;function checkCountry(e,t=!0){for(let o in countries){if(new RegExp("^/?"+o+".*","i").test(e)||countries[o].isocoden===e){defaultMap=countries[o],/^\/*[A-Z]{2}\+/.test(e)?defaultMapBase=defaultMap.scientificBase:(defaultMapBase=defaultMap.postalcodeBaseAbs,isLogAfaCodeAbs=!0),t&&resetDef();break}}}var uri=window.location.href;let pathname=window.location.pathname;pathname=pathname.split(/[#]/)[0],pathname.match(/^\/[A-Z]{2}.+$/i)&&checkCountry(pathname,!1);var openstreetmap=L.tileLayer(osmUrl,{detectRetina:!0,minZoom:0,maxNativeZoom:19,maxZoom:25}),grayscale=L.tileLayer(cartoUrl,{id:"light_all",detectRetina:!0,maxNativeZoom:22,maxZoom:25}),baseLayers={Grayscale:grayscale,OpenStreetMap:openstreetmap},layerPolygonCurrent=new L.geoJSON(null,{style:style,onEachFeature:onEachFeature,pointToLayer:pointToLayer}),layerCenterCurrent=new L.geoJSON(null,{style:style,onEachFeature:onEachFeature,pointToLayer:pointToLayer}),layerPolygonCurrentGrid=new L.geoJSON(null,{style:stylePolygonCurrentGrid,onEachFeature:onEachFeaturePolygonCurrentGrid,pointToLayer:pointToLayer,filter:filterLayer}),layerOlcGhsCurrent=new L.geoJSON(null,{style:styleOlcGhs,onEachFeature:onEachFeatureOlcGhs,pointToLayer:pointToLayer}),layerOlcGhsAll=new L.geoJSON(null,{style:styleOlcGhs,onEachFeature:onEachFeatureOlcGhsAll,pointToLayer:pointToLayer}),layerGridAll=new L.geoJSON(null,{style:stylePolygonCurrentGrid,onEachFeature:onEachFeaturePolygonCurrentGrid,pointToLayer:pointToLayer,filter:filterLayer}),layerPolygonAll=new L.geoJSON(null,{style:style,onEachFeature:onEachFeaturePolygonAll,pointToLayer:pointToLayer}),layerCenterAll=new L.geoJSON(null,{style:style,onEachFeature:onEachFeaturePolygonAll,pointToLayer:pointToLayer}),layerJurisdAll=new L.geoJSON(null,{style:styleJurisdAll,onEachFeature:onEachFeatureJurisd,pointToLayer:pointToLayer}),layerCoverAll=new L.geoJSON(null,{style:styleCoverAll,onEachFeature:onEachFeatureCoverAll,pointToLayer:pointToLayer}),layerMarkerCurrent=new L.featureGroup,layerMarkerAll=new L.featureGroup,overlays={"AFAcode (Active)":layerPolygonCurrent,"AFAcode (Center)":layerCenterCurrent,"AFAcode (Grid)":layerPolygonCurrentGrid,"Markers (Active)":layerMarkerCurrent,"Jurisdiction (Official)":layerJurisdAll,"OLC/GHS (Active)":layerOlcGhsCurrent,"OLC/GHS (All)":layerOlcGhsAll},map=L.map("map",{center:defaultMap.center,zoom:defaultMap.zoom,attributionControl:!0,zoomControl:!1,renderer:L.svg(),layers:[grayscale,layerPolygonCurrent,layerCenterCurrent,layerPolygonCurrentGrid,layerCoverAll,layerJurisdAll,layerOlcGhsCurrent,layerOlcGhsAll]});map.attributionControl.setPrefix(!1),map.addControl(new L.Control.Fullscreen({position:"topleft"})),map.on("click",handleMapClick);var zoom=L.control.zoom({position:"topleft"}),layers=L.control.layers(baseLayers,overlays,{position:"topleft"}),decodeGgeohash=L.control({position:"topleft"});decodeGgeohash.onAdd=function(e){return this.container=L.DomUtil.create("div"),this.label_field=L.DomUtil.create("label","",this.container),this.field=L.DomUtil.create("input","",this.container),this.button=L.DomUtil.create("button","leaflet-control-button",this.container),this.label_field.for="fielddecode",this.label_field.innerHTML="Grid id: ",this.field.type="text",this.field.placeholder="e.g.: "+defaultMapBase.placeholderDecode,this.field.id="fielddecode",this.button.type="button",this.button.innerHTML="Decode",L.DomEvent.disableScrollPropagation(this.button),L.DomEvent.disableClickPropagation(this.button),L.DomEvent.disableScrollPropagation(this.field),L.DomEvent.disableClickPropagation(this.field),L.DomEvent.on(this.button,"click",getDecode,this.container),L.DomEvent.on(this.field,"keyup",(function(e){13===e.keyCode&&getDecode(e)}),this.container),this.container};var encodeGgeohash=L.control({position:"topleft"});encodeGgeohash.onAdd=function(e){return this.container=L.DomUtil.create("div","leaflet-control-encode"),this.label_field=L.DomUtil.create("label","",this.container),this.label_tcode=L.DomUtil.create("label","",this.container),this.select_tcode=L.DomUtil.create("select","",this.container),this.field=L.DomUtil.create("input","",this.container),this.button=L.DomUtil.create("button","leaflet-control-button",this.container),this.span=L.DomUtil.create("span","",this.container),this.button2=L.DomUtil.create("button","getGeo-button",this.container),this.label_tcode.for="tcode",this.label_tcode.innerHTML="",this.select_tcode.id="tcode",this.select_tcode.name="tcode",this.select_tcode.innerHTML='<option value="none">(Free)</option><option value="">AFAcode</option><option value="olc">OLC</option><option value="ghs">GHS</option>',this.label_field.for="fieldencode",this.label_field.innerHTML="Equivalent Geo URI:<br/>",this.field.type="text",this.field.placeholder="e.g.: "+defaultMapBase.placeholderEncode,this.field.id="fieldencode",this.button.type="button",this.button.innerHTML="Encode",this.span.innerHTML=" or ",this.button2.type="button",this.button2.innerHTML="Open with Geohack",L.DomEvent.disableScrollPropagation(this.container),L.DomEvent.disableClickPropagation(this.container),L.DomEvent.on(this.button,"click",getEncode,this.container),L.DomEvent.on(this.button2,"click",(()=>go_to_geohackString()),this.container),L.DomEvent.on(this.field,"keyup",(function(e){13===e.keyCode&&getEncode(e)}),this.container),L.DomEvent.on(this.select_tcode,"change",changePlaceholder,this.container),this.container};var level=L.control({position:"topleft"});level.onAdd=function(e){return this.container=L.DomUtil.create("div"),this.label_level=L.DomUtil.create("label","",this.container),this.select_level=L.DomUtil.create("select","",this.container),this.label_level.for="level",this.label_level.innerHTML='<a href="https://wiki.addressforall.org/doc/osmc:Viz/Navega%C3%A7%C3%A3o" target="_help">Level</a>: ',this.select_level.id="level_size",this.select_level.name="level",this.select_level.innerHTML=generateSelectLevel(defaultMapBase),L.DomEvent.disableScrollPropagation(this.container),L.DomEvent.disableClickPropagation(this.container),this.container};var levelFilter=L.control({position:"topleft"});levelFilter.onAdd=function(e){this.container=L.DomUtil.create("div"),this.label_filter=L.DomUtil.create("label","",this.container),this.select_filter=L.DomUtil.create("select","",this.container),this.label_filter.for="filter",this.label_filter.innerHTML="Level filter: ",this.select_filter.id="filter_size",this.select_filter.name="filter";const t="base16h"===defaultMapBase.name?null:51,o=[{value:0,label:"All"},{value:1,label:"Half"},{value:2,label:"Int"},{value:4,label:"Hexadecimal"},{value:5,label:"base32"},{value:51,label:"base32 BR"}].map((e=>{const o=e.value===t?" selected":"";return`<option value="${e.value}"${o}>${e.label}</option>`})).join("");return this.select_filter.innerHTML=o,L.DomEvent.disableScrollPropagation(this.container),L.DomEvent.disableClickPropagation(this.container),L.DomEvent.on(this.select_filter,"change",updateSelectLevel,this.container),this.container};var clear=L.control({position:"topleft"});clear.onAdd=function(e){return this.container=L.DomUtil.create("div"),this.button=L.DomUtil.create("button","leaflet-control-button",this.container),this.button.type="button",this.button.innerHTML="Clear all",L.DomEvent.disableScrollPropagation(this.button),L.DomEvent.disableClickPropagation(this.button),L.DomEvent.on(this.button,"click",resetDef,this.container),this.container};var toggleTooltip=L.control({position:"topleft"});toggleTooltip.onAdd=function(e){return this.container=L.DomUtil.create("div"),this.button=L.DomUtil.create("button","leaflet-control-button",this.container),this.button.type="button",this.button.innerHTML="Tooltip",L.DomEvent.disableScrollPropagation(this.button),L.DomEvent.disableClickPropagation(this.button),L.DomEvent.on(this.button,"click",toggleTooltipLayers,this.container),this.container};var geoUriDiv=L.control({position:"topright"});geoUriDiv.onAdd=function(e){return this.container=L.DomUtil.create("div"),this.container.innerHTML='<a id="hasGeoUri" href="#fieldencode" title="Latitude,Longitude: click here to get it as Geo URI standard"><span id="geoUri" class="font_small"></span></a>',L.DomEvent.disableScrollPropagation(this.container),L.DomEvent.disableClickPropagation(this.container),this.container};const myLocationControl=L.Control.extend({options:{position:"topleft"},onAdd:function(){const e=L.DomUtil.create("div","leaflet-bar leaflet-control"),t=L.DomUtil.create("a","",e);return t.innerHTML="&#8982",t.href="#",t.title="My location",e.onclick=()=>{getMyLocation(handleLocation)},L.DomEvent.disableScrollPropagation(e),L.DomEvent.disableClickPropagation(e),e}});map.addControl(new myLocationControl);const CustomControlContainer=L.Control.extend({options:{position:"bottomright"},onAdd:function(e){const t=L.DomUtil.create("div","custom-control-container"),o=L.DomUtil.create("div","leaflet-control");o.innerHTML="&#8505",o.title="Credits",o.onclick=function(){window.location.href="https://wiki.addressforall.org/doc/osmc:Atribui%C3%A7%C3%B5es"},L.DomEvent.disableClickPropagation(o),t.appendChild(o);return L.control.scale({position:"bottomright",imperial:!1}).addTo(e),setTimeout((()=>{const e=document.querySelector(".leaflet-control-scale");e&&t.appendChild(e)}),0),t}});map.addControl(new CustomControlContainer),[zoom,layers,geoUriDiv,decodeGgeohash,encodeGgeohash,level,levelFilter,clear,toggleTooltip].forEach((e=>e.addTo(map)));var a=document.getElementById("custom-map-controlsa"),b=document.getElementById("custom-map-controlsb");function resetDef(){layerPolygonCurrent.clearLayers(),layerCenterCurrent.clearLayers(),layerPolygonCurrentGrid.clearLayers(),layerGridAll.clearLayers(),layerCenterAll.clearLayers(),layerPolygonAll.clearLayers(),layerMarkerCurrent.clearLayers(),layerMarkerAll.clearLayers(),layerOlcGhsCurrent.clearLayers(),layerOlcGhsAll.clearLayers(),map.removeLayer(layerCoverAll),toggleCoverStatus=!0,document.getElementById("level_size").innerHTML=generateSelectLevel(defaultMapBase),document.getElementById("grid").innerHTML=generateSelectGrid(defaultMapBase.selectGrid),document.getElementById("fielddecode").placeholder="geocode, e.g.: "+defaultMapBase.placeholderDecode,document.getElementById("fieldencode").placeholder="geo: "+defaultMapBase.placeholderEncode}function zoomToJurisd(){map.setView(defaultMap.center,defaultMap.zoom)}function toggleTooltipLayers(){map.eachLayer((function(e){if(map.hasLayer(e)&&e.getTooltip()){var t=e.getTooltip();e.unbindTooltip(),t.options.permanent=!toggleTooltipStatus,e.bindTooltip(t)}})),toggleTooltipStatus=!toggleTooltipStatus}function updateSelectLevel(){let e=document.getElementById("level_size").value,t=document.getElementById("filter_size").value;document.getElementById("level_size").innerHTML=generateSelectLevel(defaultMapBase,e,t)}function changePlaceholder(){let e=document.getElementById("tcode").value,t=document.getElementById("fieldencode").value;!e.match(/^(olc|ghs|ghs64)$/i)||null!==t&&""!==t?document.getElementById("fieldencode").placeholder="e.g.: "+defaultMapBase.placeholderEncode:document.getElementById("fieldencode").placeholder="e.g.: geo:"+(""===e?"":e+":")+defaultMapBase.placeholderEncode}a.appendChild(decodeGgeohash.getContainer()),a.appendChild(encodeGgeohash.getContainer()),a.appendChild(level.getContainer()),a.appendChild(levelFilter.getContainer()),b.appendChild(clear.getContainer()),b.appendChild(toggleTooltip.getContainer());const regexGeoUri=/^(geo:((olc|ghs|ghs64):)?)?(\-?\d+\.?\d*,\-?\d+\.?\d*)((;u=)(\d+\.?\d*))?$/i,regexLex=/^(urn|geo):lex:.+$/i;function isTypeAfaCode(){const e=document.getElementById("tcode").value;return""===e||"none"===e}function buildGeoPrefix(e=!0){return e?"geo:"+(isTypeAfaCode()?"":`${document.getElementById("tcode").value}:`):"geo:afa:"}function checkUValue(e){const t=e.match(regexGeoUri);let o=document.getElementById("level_size").value;return t&&void 0!==t[7]&&(o=Number(t[7]),0==o&&(o=levelValues[defaultMapBase.endLevel]),o=o>9?Math.round(o):Math.round(10*o)/10),o}function addMarker(e,t,o){const l=`latlng: ${`${latRound(o.lat)},${latRound(o.lng)}`}`;e.clearLayers(),L.marker(o).addTo(e).bindPopup(l),L.marker(o).addTo(t).bindPopup(l)}function processGeoUri(e,t,o,l=!1,r=!1){let i,a,n=`${uri_base_api}/${e}`;if(l)loadGeojson(e,[layerJurisdAll],afterLoadJurisdAll,afterData);else if(r)window.location.href=`${uri_base_api}/${e}`;else{switch(t){case!0:i=[layerPolygonCurrent,layerPolygonAll],a=afterData;break;case!1:i=[layerOlcGhsCurrent,layerOlcGhsAll],a=afterDataOlcGhs}if(o){const t=e.replace(regexGeoUri,"$4").split(/[;,]/,2);n+="/BR",addMarker(layerMarkerCurrent,layerMarkerAll,L.latLng(t)),loadGeojson(n,i,afterLoadLayer,a)}else loadGeojson(n,i,afterLoadLayer,a)}}function getDecode(e){let t=document.getElementById("fielddecode").value.trim();if(null!==t&&""!==t){!0&&processGeoUri(t,!0,encode=!1,isLex=!1,geolocation=!1)}}function getEncode(e){let t=document.getElementById("fieldencode").value.trim();if(null!==t&&""!==t){const e=t.match(regexGeoUri),o=t.match(regexLex);let l=e&&void 0===e[3];(e||o)&&(e&&(t=buildGeoPrefix()+e[4]+";u="+checkUValue(t)),processGeoUri(t,l,encode=!0,o,geolocation=!1))}}function handleMapClick(e){const t=isTypeAfaCode();let o=`${buildGeoPrefix()}${latRound(e.latlng.lat)},${latRound(e.latlng.lng)}`;o+=";u="+checkUValue(o),processGeoUri(o,t,encode=!0)}function handleLocationError(e){const t={[e.PERMISSION_DENIED]:"User denied the request for Geolocation.",[e.POSITION_UNAVAILABLE]:"Location information is unavailable.",[e.TIMEOUT]:"The request to get user location timed out.",[e.UNKNOWN_ERROR]:"An unknown error occurred."};alert(t[e.code]||"An unexpected error occurred.")}function getMyLocation(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(e,handleLocationError):alert("Geolocation is not supported by this browser.")}function buildGeoUri(e,t=!1){const{latitude:o,longitude:l,accuracy:r}=e.coords;let i=`${buildGeoPrefix()}${o},${l}`;if(t&&r>100){confirm(`Poor GPS accuracy: ${r} m. Do you want to include this in the geolocation?`)&&(i+=`;u=${r}`)}return i}function handleLocation(e){processGeoUri(buildGeoUri(e,!0),isAfacode=isTypeAfaCode(),encode=!0,isLex=!1,geolocation=!1)}function handleLocationJurisd(e){processGeoUri(buildGeoUri(e,!1),isAfacode=isTypeAfaCode(),encode=!0,isLex=!1,geolocation=!0)}function style(e){return{color:"black",fillColor:"deeppink",fillOpacity:.1,weight:0}}function layerTooltipFeature3(e,t){t.bindTooltip(e.properties.code_subcell,{permanent:toggleTooltipStatus,direction:"auto",className:"tooltipbase16h1ca"})}function highlightFeature(e){this.openTooltip()}function resetHighlight(e,t){layerPolygonCurrent.resetStyle(e.target),layerPolygonAll.resetStyle(e.target)}function onFeatureClick(e){map.fitBounds(e.target.getBounds())}function pointToLayer(e,t){return L.circleMarker(t,{radius:3,weight:1,opacity:.8,fillOpacity:.6})}function highlightFeatureOlcGhs(e){const t=e.target;document.getElementById("notooltip").checked?(this.closeTooltip(),t.setStyle({color:"yellow",weight:1}),t.bringToFront()):this.openTooltip()}function resetHighlightOlcGhs(e,t){layerOlcGhsCurrent.resetStyle(e.target),layerOlcGhsAll.resetStyle(e.target)}function styleOlcGhs(e){return{color:"black",fillColor:"yellow",fillOpacity:.1,weight:0}}function onEachFeatureOlcGhs(e,t){popUpFeature(e,t),layerTooltipFeature(e,t),L.circleMarker(t.getBounds().getCenter(),{color:"black",radius:3,weight:1,opacity:.8,fillOpacity:.6}).addTo(layerOlcGhsCurrent),t.on({click:onFeatureClick,mouseover:highlightFeature,mouseout:resetHighlight})}function onEachFeatureOlcGhsAll(e,t){popUpFeature(e,t),layerTooltipFeature(e,t),L.circleMarker(t.getBounds().getCenter(),{color:"black",radius:3,weight:1,opacity:.8,fillOpacity:.6}).addTo(layerOlcGhsAll),t.on({click:onFeatureClick,mouseover:highlightFeatureOlcGhs,mouseout:resetHighlightOlcGhs})}function onEachFeaturePolygonAll(e,t){popUpFeature(e,t),layerTooltipFeature(e,t),L.circleMarker(t.getBounds().getCenter(),{color:"black",radius:3,weight:1,opacity:.8,fillOpacity:.6}).addTo(layerCenterAll),t.on({click:onFeatureClick,mouseover:highlightFeature,mouseout:resetHighlight})}function styleJurisdAll(e){return{color:"red",fillColor:"none",fillOpacity:.1}}function onEachFeatureJurisd(e,t){var o="";o+="osm_id: "+e.properties.osm_id+"<br>",o+="jurisd_base_id: "+e.properties.jurisd_base_id+"<br>",o+="jurisd_local_id: "+e.properties.jurisd_local_id+"<br>",o+="parent_id: "+e.properties.parent_id+"<br>",o+="admin_level: "+e.properties.admin_level+"<br>",o+="name: "+e.properties.name+"<br>",o+="parent_abbrev: "+e.properties.parent_abbrev+"<br>",o+="abbrev: "+e.properties.abbrev+"<br>",o+="wikidata_id: "+e.properties.wikidata_id+"<br>",o+="lexlabel: "+e.properties.lexlabel+"<br>",o+="isolabel_ext: "+e.properties.isolabel_ext+"<br>",o+="lex_urn: "+e.properties.lex_urn+"<br>",o+="name_en: "+e.properties.name_en+"<br>",o+="isolevel: "+e.properties.isolevel+"<br>",o+="area: "+e.properties.area+"<br>",o+="jurisd_base_id: "+e.properties.jurisd_base_id+"<br>",document.getElementById("nameJurisd").innerHTML=" of "+e.properties.name,t.bindPopup(o)}function resetHighlightCoverAll(e,t){layerCoverAll.resetStyle(e.target)}function onEachFeatureCoverAll(e,t){popUpFeature(e,t),layerTooltipFeature(e,t),t.on({click:onFeatureClick,mouseover:highlightFeature,mouseout:resetHighlightCoverAll})}function styleCoverAll(e){return{color:"black",fillColor:"deeppink",fillOpacity:.1,weight:1}}function highlightFeaturePolygonCurrentGrid(e){this.openTooltip()}function filterLayer(e,t){return e.properties.code_subcell}function resetHighlightPolygonCurrentGrid(e,t){layerPolygonCurrentGrid.resetStyle(e.target),layerGridAll.resetStyle(e.target)}function stylePolygonCurrentGrid(e){return"Point"===e.geometry.type?{color:"deeppink",weight:1}:{color:"deeppink",fillColor:"deeppink",fillOpacity:.1,weight:1}}function onEachFeaturePolygonCurrentGrid(e,t){popUpFeature(e,t),layerTooltipFeature3(e,t),t.on({click:onFeatureClick,mouseover:highlightFeaturePolygonCurrentGrid,mouseout:resetHighlightPolygonCurrentGrid})}function onEachFeaturePolygonAllGrid(e,t){popUpFeature(e,t),layerTooltipFeature2(e,t),t.on({click:onFeatureClick})}function afterLoadLayer(e){let t=map.getBoundsZoom(e.getBounds());map.setView(e.getBounds().getCenter(),t-(t<10?1:t<20?2:t<24?3:4))}function afterLoadJurisdAll(e,t=!0,o=!0){t?(map.fitBounds(e.getBounds(),{reset:!0}),map.options.minZoom=map.getZoom()):map.options.minZoom=map.getBoundsZoom(e.getBounds()),o&&map.setMaxBounds(e.getBounds())}function afterLoadLayerCoverAll(e,t=!0,o=!0){toggleCoverStatus?afterLoadJurisdAll(e,t,o):(map.removeLayer(e),toggleCoverStatus=!0)}function afterDataOlcGhs(e,t){if((e.features.length=1)&&e.features[0].properties.side){document.getElementById("level_size").innerHTML=generateSelectLevel(defaultMapBase,e.features[0].properties.side,document.getElementById("filter_size").value);const o=t.getBounds().getCenter(),{lat:l,lng:r}=o,i="geo:"+latRound(l)+","+latRound(r)+";u="+document.getElementById("level_size").value;document.getElementById("geoUri").innerHTML=i,document.getElementById("fieldencode").value=i}}function loadGeojson(e,t,o,l){fetch(e).then((e=>e.json())).then((e=>{for(t[0].clearLayers(),i=0;i<t.length;i++)"FeatureCollection"===e.type?t[i].addData(e.features):t[i].addData(e);o(t[0]),l(e,t[0]),fixZOrder(overlays)})).catch((e=>{}))}function popUpFeature(e,t){sufix_area=e.properties.area<1e6?"m²":"km²",value_area=e.properties.area<1e6?Math.round(100*e.properties.area)/100:Math.round(100*e.properties.area/1e6)/100,sufix_side=e.properties.side<1e3?"m":"km",value_side=e.properties.side<1e3?Math.round(100*e.properties.side)/100:Math.round(100*e.properties.side/1e3)/100;var o="";e.properties.type?o+=e.properties.type.toUpperCase()+" code: <big><code>"+isLogAfaCodeAbs?e.id:e.properties.logistic_id+"</code></big><br>":e.properties.index?o+="Id: <big><code>"+e.properties.index+"</code></big><br>":o+=e.id,o+="Area: "+value_area+" "+sufix_area+"<br>",o+="Side: "+value_side+" "+sufix_side+"<br>",e.properties.prefix&&(o+="Prefix: "+e.properties.prefix+"<br>"),e.properties.code_subcell&&(o+="Code_subcell: "+e.properties.code_subcell+"<br>"),t.bindPopup(o)}function layerTooltipFeature(e,t){if(e.properties.code_subcell)var o=e.properties.code_subcell;else if(e.properties.index)o="."+e.properties.index;else o=isLogAfaCodeAbs?e.id:e.properties.logistic_id;t.bindTooltip(o,{permanent:toggleTooltipStatus,direction:"auto",className:"tooltipbase16h1c"})}function layerTooltipFeature2(e,t){t.bindTooltip(isLogAfaCodeAbs?e.id:e.properties.logistic_id,{permanent:toggleTooltipStatus,direction:"auto",className:"tooltipbase16h1ca"})}function onEachFeature(e,t){if(popUpFeature(e,t),layerTooltipFeature(e,t),layerCenterCurrent.clearLayers(),L.circleMarker(t.getBounds().getCenter(),{color:"black",radius:3,weight:1,opacity:.8,fillOpacity:.6}).addTo(layerCenterCurrent),isLogAfaCodeAbs){if(e.properties.logistic_id){document.getElementById("logCode").innerHTML=e.properties.logistic_id.split("~",2)[1].replace(/(...)(?!$)/g,"$1.").replace(/(\.\.)/g,".");const t=kjua({text:window.location.origin.toUpperCase()+"/"+e.properties.logistic_id,render:"svg",size:150,ecLevel:"L"});document.getElementById("qr-container").replaceChildren(t)}if(e.id){const t=e.id.split("+",2)[1].replace(/([GQHMRVJKNPSTZY])/g,".$1");document.getElementById("sciCode").innerHTML='<a href="'+uri_base+"/"+e.id+'">'+defaultMap.isocode+defaultMap.scientificBase.symbol+'<span class="feSchrift">'+t+"</span></a>"}}else e.id&&(document.getElementById("sciCode").innerHTML=e.id.split("+",2)[1].replace(/(...)(?!$)/g,"$1.").replace(/([GQHMRVJKNPSTZY])/g,".$1").replace(/(\.\.)/g,"."));t.on({click:onFeatureClick,mouseover:highlightFeature,mouseout:resetHighlight})}function afterData(e,t){if(("Feature"===e.type||"FeatureCollection"===e.type&&1==e.features.length)&&("FeatureCollection"===e.type&&(e=e.features[0]),e.properties.jurisd_base_id&&checkCountry(e.properties.jurisd_base_id,!1),!e.properties.index)){if(isLogAfaCodeAbs?feature.id:feature.properties.logistic_id,isLogAfaCodeAbs){if(e.properties.logistic_id){var o=uri_base+"/"+e.properties.logistic_id;const t="AFA.codes: "+e.properties.logistic_id,l={additionalInformation:"to canonical."};window.history.pushState(l,t,o),document.getElementById("fielddecode").value=e.properties.logistic_id,e.properties.truncated_code&&alert("Geocódigo truncado. Número de dígitos excedeu o limite de níveis da grade.")}}else if(e.id){o=uri_base+"/"+e.id;const t="AFA.codes: "+e.id,l={additionalInformation:"to canonical."};window.history.pushState(l,t,o),document.getElementById("fielddecode").value=e.id,e.properties.truncated_code&&alert("Geocódigo truncado. Número de dígitos excedeu o limite de níveis da grade.")}if(e.properties.side){document.getElementById("level_size").innerHTML=generateSelectLevel(defaultMapBase,e.properties.side,document.getElementById("filter_size").value);const o=t.getBounds().getCenter(),{lat:l,lng:r}=o,i="geo:"+latRound(l)+","+latRound(r)+";u="+document.getElementById("level_size").value;document.getElementById("geoUri").innerHTML=i,document.getElementById("fieldencode").value=i}}}var uriApi="",uriApiJurisd="";const reg_esp_caracter=/\./g;pathnameNoDot=pathname.replace(reg_esp_caracter,""),pathname.match(/\/base16\/grid/)?uriApi=uri.replace(/(\/base16\/grid)/,"$1"):pathname.match(/(\/base16h)?\/grid/)?uriApi=uri.replace(/((\/base16h)?\/grid)/,"$1"):pathnameNoDot.match(/\/[A-Z]{2}\~.*$/i)?(uriApi=uri_base_api+pathnameNoDot.replace(/\/([A-Z]{2}\~.*)$/i,"/geo:afa:$1"),uriApiJurisd=uri_base_api+pathnameNoDot.replace(/\/(([A-Z]{2})\~.*)$/i,"/geo:iso_ext:$2")):pathname.match(/\/[A-Z]{2}\/geo:(olc|ghs):.+$/i)?(loadGeojson(uri.replace(/\/[A-Z]{2}\/(geo:(olc|ghs).*)$/i,"/$1"),[layerOlcGhsCurrent,layerOlcGhsAll],afterLoadLayer,afterDataOlcGhs),loadGeojson(uri.replace(/\/([A-Z]{2})\/(geo:(olc|ghs).*)$/i,"/geo:iso_ext:$1"),[layerJurisdAll],(function(e){afterLoadJurisdAll(e,!1,!1)}),afterData)):pathname.match(/^\/geo:.+$/i)&&(uriApi=uri,getJurisdAfterLoad=!0),null!==uriApi&&""!==uriApi&&loadGeojson(uriApi,[layerPolygonCurrent,layerPolygonAll],afterLoadLayer,afterData),null!==uriApiJurisd&&""!==uriApiJurisd&&(loadGeojson(uriApiJurisd,[layerJurisdAll],(function(e){afterLoadJurisdAll(e,!1,!1)}),afterData),loadGeojson(uriApiJurisd+"/cover",[layerCoverAll],(function(e){afterLoadLayerCoverAll(e,!1,!1)}),(function(e){})));