function changeLevel_byDigits(e){const t=document.getElementById("fielddecode");let o=t.value.trim();if(o.length>0){if(e>0)t.value=o+"7";else{if(!(e<0&&o.length>1))return void alert("Check code or level limits");t.value=o.substring(0,o.length-1)}getDecode()}else alert("Click a point first.")}function sel_jurL1(e){if(e>""){let o=document.getElementById("sel_jurL2"),l='<option value="">- States -</option>';for(var t of Object.keys(jurisdictions[e]))l+='<option value="'+t+'">'+("CO"!=e?t:jurisdictions[e][t].name);o.innerHTML=l,document.getElementById("sel_jurL3").innerHTML=""}}function sel_jurL2(e){let t=defaultMap.isocode,o=document.getElementById("sel_jurL2").value,l=document.getElementById("sel_jurL3"),i='<option value="">- Cities -</option>';if(""!=o)for(var r of(jurisdictions[t][o].draft||[]).concat(jurisdictions[t][o].work||[]).sort())i+="<option>"+r;l.innerHTML=i}function sel_jurL3(e){let t=defaultMap.isocode,o=document.querySelector("#sel_jurL2").value,l=document.getElementById("sel_jurL3").value;""!=l&&""!=o&&(window.location.href=`${uri_base}/${t}-${o}-${l}`)}function latRound(e,t=6){return Number.parseFloat(e).toFixed(t)}function buildOptionsHTML(e,t,o){return e.map((e=>`<option value="${e}"${t===e?" selected":""}>${o(e)}</option>`)).join("")}function updateJurisd(e){const[t,o,l]=e.split("-",3),i=jurisdictions[t],r=buildOptionsHTML(Object.keys(i),o,(e=>"CO"!==t?e:i[e].name)),n=buildOptionsHTML([...i[o].draft||[],...i[o].work||[]].sort(),l,(e=>e));document.getElementById("sel_jurL1").innerHTML=t,document.getElementById("sel_jurL2").innerHTML=`<option value="">- States -</option>${r}`,document.getElementById("sel_jurL3").innerHTML=`<option value="">- Cities -</option>${n}`}var centerCurrentCell,openstreetmap=L.tileLayer(osmUrl,{attribution:genericAttrib,detectRetina:!0,minZoom:0,maxNativeZoom:19,maxZoom:25}),grayscale=L.tileLayer(cartoUrl,{id:"light_all",attribution:genericAttrib,detectRetina:!0,maxNativeZoom:22,maxZoom:25}),baseLayers={Grayscale:grayscale,OpenStreetMap:openstreetmap},layerPolygonCurrent=new L.geoJSON(null,{style:style,onEachFeature:onEachFeature,pointToLayer:pointToLayer}),layerPolygonAll=new L.geoJSON(null,{style:style,onEachFeature:onEachFeaturePolygonAll,pointToLayer:pointToLayer}),layerOlcGhsCurrent=new L.geoJSON(null,{style:styleOlcGhs,onEachFeature:onEachFeatureOlcGhs,pointToLayer:pointToLayer}),layerOlcGhsAll=new L.geoJSON(null,{style:styleOlcGhs,onEachFeature:onEachFeatureOlcGhsAll,pointToLayer:pointToLayer}),layerJurisdAll=new L.geoJSON(null,{style:styleJurisdAll,onEachFeature:onEachFeatureJurisd,pointToLayer:pointToLayer}),layerJurisdAll2=new L.geoJSON(null,{style:styleJurisdAll2,onEachFeature:onEachFeatureJurisd,pointToLayer:pointToLayer}),layerCoverAll=new L.geoJSON(null,{style:styleCoverAll,onEachFeature:onEachFeatureCoverAll,pointToLayer:pointToLayer}),layerMarkerCurrent=new L.featureGroup,layerMarkerAll=new L.featureGroup,overlays={"AFAcode (Active)":layerPolygonCurrent,"AFAcode (All)":layerPolygonAll,"OLC/GHS (Active)":layerOlcGhsCurrent,"OLC/GHS (All)":layerOlcGhsAll,"Markers (Active)":layerMarkerCurrent,"Markers (All)":layerMarkerAll,Coverage:layerCoverAll,"Jurisdiction (Official)":layerJurisdAll,"Jurisdiction (Buffered)":layerJurisdAll2},defaultMap=countries.BR,sizeCurrentCell=0,getJurisdAfterLoad=!1,jurisdIsMultipolygon=!1,min_level=0,getCover=!0;function checkCountry(e,t=!0){for(var o in countries){if(new RegExp("^/?"+o+".*","i").test(e)||countries[o].isocoden===e){defaultMap=countries[o],t&&resetDef();break}}}var uri=window.location.href;let pathname=window.location.pathname;pathname=pathname.split(/[#]/)[0],pathname.match(/^\/[A-Z]{2}.+$/i)&&checkCountry(pathname,!1);var map=L.map("map",{center:defaultMap.center,zoom:defaultMap.zoom,maxBoundsViscocity:1,attributionControl:!0,zoomControl:!1,renderer:L.svg(),layers:[grayscale,layerPolygonCurrent,layerPolygonAll,layerCoverAll,layerJurisdAll2,layerOlcGhsCurrent,layerOlcGhsAll]}),toggleTooltipStatus=!1;map.attributionControl.setPrefix(!1),map.addControl(new L.Control.Fullscreen({position:"topleft"})),map.on("click",handleMapClick);var zoom=L.control.zoom({position:"topleft"}),layers=L.control.layers(baseLayers,overlays,{position:"topleft"}),escala=L.control.scale({position:"bottomright",imperial:!1}),jurisdictionGgeohash=L.control({position:"topleft"});jurisdictionGgeohash.onAdd=function(e){return this.container=L.DomUtil.create("div"),this.label_country=L.DomUtil.create("label","",this.container),this.label_state=L.DomUtil.create("label","",this.container),this.select_state=L.DomUtil.create("select","",this.container),this.label_mun=L.DomUtil.create("label","",this.container),this.select_mun=L.DomUtil.create("select","",this.container),this.label_country.for="country",this.label_country.innerHTML='Jurisdiction: <span id="sel_jurL1">'+defaultMap.isocode+"</span>",this.label_state.for="state",this.label_state.innerHTML="-",this.label_mun.for="mun",this.label_mun.innerHTML="-",this.select_state.id="sel_jurL2",this.select_state.name="state",this.select_mun.id="sel_jurL3",this.select_mun.name="mun",L.DomEvent.disableScrollPropagation(this.container),L.DomEvent.disableClickPropagation(this.container),L.DomEvent.on(this.select_state,"change",sel_jurL2,this.container),L.DomEvent.on(this.select_mun,"change",sel_jurL3,this.container),this.container};var decodeGgeohash=L.control({position:"topleft"});decodeGgeohash.onAdd=function(e){return this.container=L.DomUtil.create("div"),this.label_field=L.DomUtil.create("label","",this.container),this.field=L.DomUtil.create("input","",this.container),this.button=L.DomUtil.create("button","leaflet-control-button",this.container),this.label_field.for="fielddecode",this.label_field.innerHTML="Grid code: ",this.field.type="text",this.field.placeholder="e.g.: "+defaultMap.postalcodeBase.placeholderDecode,this.field.id="fielddecode",this.button.type="button",this.button.innerHTML="Decode",L.DomEvent.disableScrollPropagation(this.button),L.DomEvent.disableClickPropagation(this.button),L.DomEvent.disableScrollPropagation(this.field),L.DomEvent.disableClickPropagation(this.field),L.DomEvent.on(this.button,"click",getDecode,this.container),L.DomEvent.on(this.field,"keyup",(function(e){13===e.keyCode&&getDecode(e)}),this.container),this.container};var encodeGgeohash=L.control({position:"topleft"});encodeGgeohash.onAdd=function(e){return this.container=L.DomUtil.create("div","leaflet-control-encode"),this.label_field=L.DomUtil.create("label","",this.container),this.label_tcode=L.DomUtil.create("label","",this.container),this.select_tcode=L.DomUtil.create("select","",this.container),this.field=L.DomUtil.create("input","",this.container),this.button=L.DomUtil.create("button","leaflet-control-button",this.container),this.span=L.DomUtil.create("span","",this.container),this.button2=L.DomUtil.create("button","getGeo-button",this.container),this.label_tcode.for="tcode",this.label_tcode.innerHTML="",this.select_tcode.id="tcode",this.select_tcode.name="tcode",this.select_tcode.innerHTML=generateSelectTypeCode("aaa"),this.label_field.for="fieldencode",this.label_field.innerHTML="Equivalent Geo URI:<br/>",this.field.type="text",this.field.placeholder="e.g.: "+defaultMap.postalcodeBase.placeholderEncode,this.field.id="fieldencode",this.button.type="button",this.button.innerHTML="Encode",this.span.innerHTML=" or ",this.button2.type="button",this.button2.innerHTML="My Location",L.DomEvent.disableScrollPropagation(this.container),L.DomEvent.disableClickPropagation(this.container),L.DomEvent.on(this.button,"click",getEncode,this.container),L.DomEvent.on(this.button2,"click",(()=>getMyLocation(handleLocation)),this.container),L.DomEvent.on(this.field,"keyup",(e=>{13===e.keyCode&&getEncode(e)}),this.container),L.DomEvent.on(this.select_tcode,"change",changePlaceholder,this.container),this.container};var level=L.control({position:"topleft"});function createControl({id:e,label:t,buttonLabel:o,buttonAction:l,position:i="topleft",type:r="button",checkbox:n=!1,checked:a=!1}){const s=L.control({position:i});return s.onAdd=function(i){const s=L.DomUtil.create("div");if(t){L.DomUtil.create("label","",s).innerHTML=t}if(n){const t=L.DomUtil.create("input","",s);t.type="checkbox",t.id=e,t.checked=a,L.DomEvent.on(t,"click",l)}else{const e=L.DomUtil.create(r,"",s);e.innerHTML=o,L.DomEvent.on(e,"click",l)}return L.DomEvent.disableScrollPropagation(s),L.DomEvent.disableClickPropagation(s),s},s}level.onAdd=function(e){return this.container=L.DomUtil.create("div"),this.label_level=L.DomUtil.create("label","",this.container),this.select_level=L.DomUtil.create("select","",this.container),this.label_level.for="level",this.label_level.innerHTML='<a href="https://wiki.addressforall.org/doc/osmc:Viz/Navega%C3%A7%C3%A3o" target="_help">Level</a>: ',this.select_level.id="level_size",this.select_level.name="level",L.DomEvent.disableScrollPropagation(this.container),L.DomEvent.disableClickPropagation(this.container),this.container};const clearControl=createControl({id:"clear",buttonLabel:"Clear all",buttonAction:resetDef,position:"topleft"}),toggleTooltipControl=createControl({id:"tooltip",buttonLabel:"Tooltip",buttonAction:toggleTooltipLayers,position:"topleft"}),toggleCoverageControl=createControl({id:"coverage",buttonLabel:"Coverage",buttonAction:toggleCoverLayers,position:"topleft"}),officialBordersControl=createControl({id:"officialborders",buttonLabel:"Official Borders",buttonAction:toggleOfficialBordersLayers,position:"topleft"}),zoomClickControl=createControl({id:"zoomclick",label:"Disable zoom-click: ",checkbox:!0,checked:!1,buttonAction:()=>{},position:"topleft"}),keepPreviousClickControl=createControl({id:"keepclick",label:"Keep previous clicks: ",checkbox:!0,checked:!0,buttonAction:toggleKeepClick,position:"topleft"}),noTooltipControl=createControl({id:"notooltip",label:"No tooltip: ",checkbox:!0,checked:!0,buttonAction:toggleTooltipLayers,position:"topleft"});var geoUriDiv=L.control({position:"topright"});geoUriDiv.onAdd=function(e){return this.container=L.DomUtil.create("div"),this.container.innerHTML='<a id="hasGeoUri" href="#fieldencode" title="Latitude,Longitude: click here to get it as Geo URI standard"><span id="geoUri" class="font_small"></span></a>',L.DomEvent.disableScrollPropagation(this.container),L.DomEvent.disableClickPropagation(this.container),this.container};const myLocationControl=L.Control.extend({options:{position:"topleft"},onAdd:function(){const e=L.DomUtil.create("div","leaflet-bar leaflet-control"),t=L.DomUtil.create("a","",e);return t.innerHTML="&#8982",t.href="#",t.title="My location",e.onclick=()=>{getMyLocation(handleLocationJurisd)},L.DomEvent.disableScrollPropagation(e),L.DomEvent.disableClickPropagation(e),e}});map.addControl(new myLocationControl),[zoom,layers,escala,geoUriDiv,decodeGgeohash,encodeGgeohash,level,clearControl,toggleCoverageControl,officialBordersControl,jurisdictionGgeohash,noTooltipControl,zoomClickControl,keepPreviousClickControl].forEach((e=>e.addTo(map)));var a=document.getElementById("custom-map-controlsa"),b=document.getElementById("custom-map-controlsb"),c=document.getElementById("custom-map-controlsc"),d=document.getElementById("custom-map-controlsd");function resetDef(){layerPolygonCurrent.clearLayers(),layerPolygonAll.clearLayers(),layerMarkerCurrent.clearLayers(),layerMarkerAll.clearLayers(),layerOlcGhsCurrent.clearLayers(),layerOlcGhsAll.clearLayers(),map.removeLayer(layerCoverAll),document.getElementById("fielddecode").value="",document.getElementById("fieldencode").value="",document.getElementById("fielddecode").placeholder="e.g.: "+defaultMap.postalcodeBase.placeholderDecode,document.getElementById("fieldencode").placeholder="geo:"+defaultMap.postalcodeBase.placeholderEncode,document.getElementById("logCode").innerHTML="(click the map)";window.history.pushState({additionalInformation:"to canonical."},"Logistic AFAcodes",window.location.href.split(/[~]/)[0])}function zoomToJurisd(){map.setView(defaultMap.center,defaultMap.zoom)}function toggleTooltipLayers(){map.eachLayer((function(e){if(e.getTooltip()){var t=e.getTooltip();e.unbindTooltip(),t.options.permanent=!toggleTooltipStatus,e.bindTooltip(t)}})),toggleTooltipStatus=!toggleTooltipStatus}function toggleKeepClick(){map.hasLayer(layerPolygonAll)?map.removeLayer(layerPolygonAll):map.addLayer(layerPolygonAll)}function toggleCoverLayers(){if(getCover){let e=defaultMap.isocode+"-"+document.getElementById("sel_jurL2").value+"-"+document.getElementById("sel_jurL3").value;loadGeojson(uri_base+"/"+e+".json/cover",[layerCoverAll],(function(e){}),(function(e){})),getCover=!1}else map.hasLayer(layerCoverAll)?map.removeLayer(layerCoverAll):map.addLayer(layerCoverAll),fixZOrder(overlays)}function toggleOfficialBordersLayers(){map.hasLayer(layerJurisdAll)?map.removeLayer(layerJurisdAll):map.addLayer(layerJurisdAll)}function generateSelectLevel(e,t,o=0){let l="",i=0,r=5,n=e.iniLevel;"base16h"===e.name?r=4:"base32"===e.name&&(r=5);const a=e.endLevel;for(let e=0;e<=a;e++){if(e%r!==n||e<t)continue;i=e%4==0?e/4+1:Math.floor(e/4)+2;const s=Math.pow(2,a-e),c=Math.sqrt(s),d=Math.round(111*c)/100;l+=`<option value="${d}"${o<=d?" selected":""}>L${e} (${i}d) (${c<1e3?Math.round(100*c)/100+"m":Math.round(100*c/1e3)/100+"km"}) ${e%2==0?"&#9643;":"&#9645;"}</option>`}return l}function generateSelectTypeCode(e){let t="";avalue=["none","","olc","ghs","ghs64"],aname=["(Free)","AFAcode","OLC","GHS","GHS64"];for(let o=0;o<4;o++)t+='<option value="'+avalue[o]+(avalue[o]==e?'" selected>':'">')+aname[o]+"</option>";return t}function isMarkerInsidePolygonOrMultiPolygon(e,t,o){let l=!1;const i=o.getLatLngs(),r=o=>{for(let i=0,r=o.length-1;i<o.length;r=i++){const n=o[i].lat,a=o[i].lng,s=o[r].lat,c=o[r].lng;a>t!=c>t&&e<(s-n)*(t-a)/(c-a)+n&&(l=!l)}};if(Array.isArray(i[0])&&Array.isArray(i[0][0]))for(const e of i)for(const t of e)r(t);else for(const e of i)r(e);return l}function isLatLngInsideJurisdiction(e,t,o){let l=!1;return o.eachLayer((function(o){isMarkerInsidePolygonOrMultiPolygon(e,t,o)&&(l=!0)})),l}function getJurisdictionContext(){const e=defaultMap.isocode,t=document.getElementById("sel_jurL2").value,o=document.getElementById("sel_jurL3").value;return null!==t&&""!==t&&null!==o&&""!==o?`${e}-${t}-${o}`:null}function isTypeAfaCode(){const e=document.getElementById("tcode").value;return""===e||"none"===e}function buildGeoPrefix(e=!0){return e?"geo:"+(isTypeAfaCode()?"":`${document.getElementById("tcode").value}:`):"geo:afa:"}a.appendChild(jurisdictionGgeohash.getContainer()),a.appendChild(decodeGgeohash.getContainer()),a.appendChild(encodeGgeohash.getContainer()),c.appendChild(level.getContainer()),b.appendChild(clearControl.getContainer()),b.appendChild(toggleCoverageControl.getContainer()),b.appendChild(officialBordersControl.getContainer()),d.appendChild(noTooltipControl.getContainer()),d.appendChild(zoomClickControl.getContainer()),d.appendChild(keepPreviousClickControl.getContainer());const regexGeoUri=/^(geo:((olc|ghs|ghs64):)?)?(\-?\d+\.?\d*,\-?\d+\.?\d*)((;u=)(\d+\.?\d*))?$/i,regexLex=/^(urn|geo):lex:.+$/i;function changePlaceholder(){let e=document.getElementById("fieldencode").value.trim();const t=buildGeoPrefix();null===e||""===e?document.getElementById("fieldencode").placeholder=`e.g.: ${t}${defaultMap.postalcodeBase.placeholderEncode}`:e.match(regexGeoUri)&&(e=e.replace(regexGeoUri,`${t}$4$5`),document.getElementById("fieldencode").value=`${e}`)}function checkUValue(e){const t=e.match(regexGeoUri);let o=document.getElementById("level_size").value;return t&&void 0!==t[7]&&(o=Number(t[7]),0==o&&(o=levelValues[defaultMap.postalcodeBase.endLevel]),o=o>9?Math.round(o):Math.round(10*o)/10),o}function addMarker(e,t,o){const l=`latlng: ${`${latRound(o.lat)},${latRound(o.lng)}`}`;e.clearLayers(),L.marker(o).addTo(e).bindPopup(l),L.marker(o).addTo(t).bindPopup(l)}function processGeoUri(e,t,o,l=!1,i=!1){let r,n,a=`${uri_base}/${e}.json`;if(l)loadGeojson(e,[layerJurisdAll],afterLoadJurisdAll,afterData);else if(i)window.location.href=`${uri_base}/${e}`;else{switch(t){case!0:r=[layerPolygonCurrent,layerPolygonAll],n=afterData;break;case!1:r=[layerOlcGhsCurrent,layerOlcGhsAll],n=afterDataOlcGhs}if(o){const o=e.replace(regexGeoUri,"$4").split(/[;,]/,2),l=isLatLngInsideJurisdiction(o[0],o[1],layerJurisdAll2),i=getJurisdictionContext();t&&null!==i&&(a+="/"+i),t&&null!==i&&!l?alert("Error: outside of current jurisdiction."):(addMarker(layerMarkerCurrent,layerMarkerAll,L.latLng(o)),loadGeojson(a,r,afterLoadLayer,n))}else loadGeojson(a,r,afterLoadLayer,n)}}function getDecode(e){let t=document.getElementById("fielddecode").value.trim();if(null!==t&&""!==t){const e=!0;if(!0){const o=getJurisdictionContext();e&&null!==o&&(t=buildGeoPrefix(!1)+o+defaultMap.postalcodeBase.symbol+t),processGeoUri(t,e,encode=!1,isLex=!1,geolocation=!1)}}}function getEncode(e){let t=document.getElementById("fieldencode").value.trim();if(null!==t&&""!==t){const e=t.match(regexGeoUri),o=t.match(regexLex);let l=e&&void 0===e[3];(e||o)&&(e&&(t=buildGeoPrefix()+e[4]+";u="+checkUValue(t)),processGeoUri(t,l,encode=!0,o,geolocation=!1))}}function handleMapClick(e){const t=isTypeAfaCode();let o=`${buildGeoPrefix()}${latRound(e.latlng.lat)},${latRound(e.latlng.lng)}`;o+=";u="+checkUValue(o),processGeoUri(o,t,encode=!0)}function handleLocationError(e){const t={[e.PERMISSION_DENIED]:"User denied the request for Geolocation.",[e.POSITION_UNAVAILABLE]:"Location information is unavailable.",[e.TIMEOUT]:"The request to get user location timed out.",[e.UNKNOWN_ERROR]:"An unknown error occurred."};alert(t[e.code]||"An unexpected error occurred.")}function getMyLocation(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(e,handleLocationError):alert("Geolocation is not supported by this browser.")}function buildGeoUri(e,t=!1){const{latitude:o,longitude:l,accuracy:i}=e.coords;let r=`${buildGeoPrefix()}${o},${l}`;if(t&&i>100){confirm(`Poor GPS accuracy: ${i} m. Do you want to include this in the geolocation?`)&&(r+=`;u=${i}`)}return r}function handleLocation(e){processGeoUri(buildGeoUri(e,!0),isAfacode=isTypeAfaCode(),encode=!0,isLex=!1,geolocation=!1)}function handleLocationJurisd(e){processGeoUri(buildGeoUri(e,!1),isAfacode=isTypeAfaCode(),encode=!0,isLex=!1,geolocation=!0)}function sortAndRemoveDuplicates(e){return[...new Set(e.trim().split(/[\n,]+/).map((e=>e.trim().substring(0,11))))].sort().join(",")}function fixZOrder(e){Object.keys(e).forEach((function(t){var o=e[t];o._layers&&Object.keys(o._layers).length>0&&o._layers[Object.keys(o._layers)[0]]._path&&o._layers[Object.keys(o._layers)[0]]._path.parentNode&&o.bringToFront()}))}function style(e){return{color:"black",fillColor:"deeppink",fillOpacity:.1,weight:0}}function popUpFeature(e,t){sufix_area=e.properties.area<1e6?"m²":"km²",value_area=e.properties.area<1e6?Math.round(100*e.properties.area)/100:Math.round(100*e.properties.area/1e6)/100,sufix_side=e.properties.side<1e3?"m":"km",value_side=e.properties.side<1e3?Math.round(100*e.properties.side)/100:Math.round(100*e.properties.side/1e3)/100;var o="";e.properties.logistic_id?(o+="Logistic code: <big><code>"+e.properties.logistic_id.split(/[~]/)[1]+"</code></big><br>",o+="Area: "+value_area+" "+sufix_area+"<br>",o+="Side: "+value_side+" "+sufix_side+"<br>",e.properties.isolabel_ext&&(o+="Jurisdiction label: <code>"+e.properties.isolabel_ext+"</code><br>"),e.properties.jurisd_local_id&&(o+="Jurisdiction code: "+e.properties.jurisd_local_id+"<br>")):(e.properties.type?o+=e.properties.type.toUpperCase()+" code: <big><code>"+e.id+"</code></big><br>":e.properties.index?o+="Code: <big><code>"+e.properties.index+"</code></big><br>":o+="Code: <big><code>"+e.id+"</code></big><br>",o+="Area: "+value_area+" "+sufix_area+"<br>",o+="Side: "+value_side+" "+sufix_side+"<br>",e.properties.prefix&&(o+="Prefix: "+e.properties.prefix+"<br>"),e.properties.code_subcell&&(o+="Code_subcell: "+e.properties.code_subcell+"<br>")),t.bindPopup(o)}function layerTooltipFeature(e,t){if(e.properties.code_subcell)var o=e.properties.code_subcell;else if(e.properties.logistic_id)o="."+e.properties.logistic_id.split(/[~]/)[1];else if(e.properties.index)o="."+e.properties.index;else o=e.id;t.bindTooltip(o,{permanent:toggleTooltipStatus,direction:"auto",className:"tooltip"+e.properties.base})}function highlightFeature(e){const t=e.target;document.getElementById("notooltip").checked?(this.closeTooltip(),t.setStyle({color:"deeppink",weight:1}),t.bringToFront()):this.openTooltip()}function resetHighlight(e,t){layerPolygonCurrent.resetStyle(e.target),layerPolygonAll.resetStyle(e.target)}function onFeatureClick(e){!document.getElementById("zoomclick").checked&&map.fitBounds(e.target.getBounds())}function onEachFeature(e,t){const o=/(...)(?!$)/g;popUpFeature(e,t),layerTooltipFeature(e,t);const l=t.getBounds().getCenter();if(L.circleMarker(l,{color:"black",radius:3,weight:1,opacity:.8,fillOpacity:.6}).addTo(layerPolygonCurrent),e.id){const t=e.id.replace(/([GQHMRVJKNPSTZY])/g,".$1");document.getElementById("sciCode").innerHTML='<a href="'+uri_base+"/"+defaultMap.isocode+defaultMap.scientificBase.symbol+e.id+'">'+defaultMap.isocode+defaultMap.scientificBase.symbol+'<span class="feSchrift">'+t+"</span></a>"}e.properties.logistic_id&&(document.getElementById("sel_jurL3").innerHTML!=e.properties.logistic_id.split(/[-~]/)[2]&&updateJurisd(e.properties.isolabel_ext),document.getElementById("logCode").innerHTML=e.properties.logistic_id.split(/[~]/)[1].replace(o,"$1.")),t.on({click:onFeatureClick,mouseover:highlightFeature,mouseout:resetHighlight})}function pointToLayer(e,t){return L.circleMarker(t,{radius:3,weight:1,opacity:.8,fillOpacity:.6})}function highlightFeatureOlcGhs(e){const t=e.target;document.getElementById("notooltip").checked?(this.closeTooltip(),t.setStyle({color:"yellow",weight:1}),t.bringToFront()):this.openTooltip()}function resetHighlightOlcGhs(e,t){layerOlcGhsCurrent.resetStyle(e.target),layerOlcGhsAll.resetStyle(e.target)}function styleOlcGhs(e){return{color:"black",fillColor:"yellow",fillOpacity:.1,weight:0}}function onEachFeatureOlcGhs(e,t){popUpFeature(e,t),layerTooltipFeature(e,t),L.circleMarker(t.getBounds().getCenter(),{color:"black",radius:3,weight:1,opacity:.8,fillOpacity:.6}).addTo(layerOlcGhsCurrent),t.on({click:onFeatureClick,mouseover:highlightFeature,mouseout:resetHighlight})}function onEachFeatureOlcGhsAll(e,t){popUpFeature(e,t),layerTooltipFeature(e,t),L.circleMarker(t.getBounds().getCenter(),{color:"black",radius:3,weight:1,opacity:.8,fillOpacity:.6}).addTo(layerOlcGhsAll),t.on({click:onFeatureClick,mouseover:highlightFeatureOlcGhs,mouseout:resetHighlightOlcGhs})}function onEachFeaturePolygonAll(e,t){popUpFeature(e,t),layerTooltipFeature(e,t),L.circleMarker(t.getBounds().getCenter(),{color:"black",radius:3,weight:1,opacity:.8,fillOpacity:.6}).addTo(layerPolygonAll),t.on({click:onFeatureClick,mouseover:highlightFeature,mouseout:resetHighlight})}function styleJurisdAll(e){return{color:"red",fillColor:"none",fillOpacity:.1,weight:2,dashArray:"5, 5"}}function styleJurisdAll2(e){return{color:"red",fillColor:"none",fillOpacity:.1}}function onEachFeatureJurisd(e,t){updateJurisd(e.properties.isolabel_ext);var o="";o+="osm_id: "+e.properties.osm_id+"<br>",o+="jurisd_base_id: "+e.properties.jurisd_base_id+"<br>",o+="jurisd_local_id: "+e.properties.jurisd_local_id+"<br>",o+="parent_id: "+e.properties.parent_id+"<br>",o+="admin_level: "+e.properties.admin_level+"<br>",o+="name: "+e.properties.name+"<br>",o+="parent_abbrev: "+e.properties.parent_abbrev+"<br>",o+="abbrev: "+e.properties.abbrev+"<br>",o+="wikidata_id: "+e.properties.wikidata_id+"<br>",o+="lexlabel: "+e.properties.lexlabel+"<br>",o+="isolabel_ext: "+e.properties.isolabel_ext+"<br>",o+="lex_urn: "+e.properties.lex_urn+"<br>",o+="name_en: "+e.properties.name_en+"<br>",o+="isolevel: "+e.properties.isolevel+"<br>",o+="area: "+e.properties.area+"<br>",o+="jurisd_base_id: "+e.properties.jurisd_base_id+"<br>",document.getElementById("nameJurisd").innerHTML=" of "+e.properties.name,t.bindPopup(o),jurisdIsMultipolygon=e.properties.is_multipolygon,min_level=e.properties.min_level}function resetHighlightCoverAll(e,t){layerCoverAll.resetStyle(e.target)}function onEachFeatureCoverAll(e,t){popUpFeature(e,t),layerTooltipFeature(e,t),t.on({click:onFeatureClick,mouseover:highlightFeature,mouseout:resetHighlightCoverAll})}function styleCoverAll(e){return{color:"black",fillColor:"deeppink",fillOpacity:.1,weight:1}}function afterLoadLayer(e){let t=document.getElementById("zoomclick"),o=map.getBoundsZoom(e.getBounds());!t.checked&&map.setView(e.getBounds().getCenter(),o-(o<10?1:o<20?2:o<24?3:4))}function afterLoadCurrent(e){let t=map.getBoundsZoom(e.getBounds());map.setView(e.getBounds().getCenter(),t-(t<10?1:t<20?2:t<24?3:4))}function afterLoadJurisdAll(e,t=!0,o=!0){t?(map.fitBounds(e.getBounds(),{reset:!0}),map.options.minZoom=map.getZoom()):map.options.minZoom=map.getBoundsZoom(e.getBounds()),map.setMaxBounds(e.getBounds()),o&&(document.getElementById("level_size").innerHTML=generateSelectLevel(defaultMap.postalcodeBase,min_level))}function generateBorderLinks(e){return e.map((e=>`<a href="./${e}" title="AFAcodes of ${e}">${e}</a>`)).join(", ")}function afterData(e,t){if("Feature"===e.type||"FeatureCollection"===e.type&&1==e.features.length){if("FeatureCollection"===e.type&&(e=e.features[0]),e.properties.jurisd_base_id&&(checkCountry(e.properties.jurisd_base_id,!1),e.properties.shares_border_with)){const t=generateBorderLinks(e.properties.shares_border_with);document.getElementById("borderLinks").innerHTML=t}if(e.properties.isolabel_ext&&!e.properties.logistic_id){var o=uri_base+"/"+e.properties.canonical_pathname;const t="AFA.codes: "+e.properties.canonical_pathname,l={additionalInformation:"to canonical."};window.history.pushState(l,t,o)}else if(!e.properties.index)if(e.properties.logistic_id){let l=e.properties.logistic_id,i=l.split(/[~]/)[1];if(getJurisdAfterLoad)getJurisdAfterLoad=!1,loadGeojson(uri_base+"/geo:iso_ext:"+e.properties.isolabel_ext+".json",[layerJurisdAll],(function(e){afterLoadJurisdAll(e,!1)}),(function(e){}));o=uri_base+"/"+l;const r="AFA.codes: "+l,n={additionalInformation:"to canonical."};if(window.history.pushState(n,r,o),document.getElementById("fielddecode").value=i,e.properties.isolabel_ext_abbrev){const t=e=>e.replace(/([a-z])([A-Z])/g,"$1.$2"),o=e.properties.isolabel_ext_abbrev.map((e=>{const o=t(e);return`<a href="./${o}~${i}" title="AFAcode ${o}~${i}"><small>${o}~</small>${i}</a>`})).join(", ");document.getElementById("canonicalCode").innerHTML=o}else document.getElementById("canonicalCode").innerHTML="";if(e.properties.truncated_code&&alert("Geocódigo truncado. Número de dígitos excedeu o limite de níveis da grade."),e.properties.side){sizeCurrentCell=e.properties.side,document.getElementById("level_size").innerHTML=generateSelectLevel(defaultMap.postalcodeBase,min_level,sizeCurrentCell);let o=document.getElementById("level_size").value<=64?5:4;centerCurrentCell=t.getBounds().getCenter();const{lat:l,lng:i}=centerCurrentCell;document.getElementById("geoUri").innerHTML="geo:"+latRound(l,o)+","+latRound(i,o),document.getElementById("fieldencode").value="geo:"+latRound(l)+","+latRound(i)+";u="+document.getElementById("level_size").value}}else e.id&&(document.getElementById("fielddecode").value=e.id)}}function afterDataOlcGhs(e,t){if((e.features.length=1)&&e.features[0].properties.side){sizeCurrentCell=e.features[0].properties.side,document.getElementById("level_size").innerHTML=generateSelectLevel(defaultMap.postalcodeBase,min_level,sizeCurrentCell),document.getElementById("tcode").innerHTML=generateSelectTypeCode(e.features[0].properties.type);let l=document.getElementById("level_size").value<=64?5:4;centerCurrentCell=t.getBounds().getCenter();const{lat:i,lng:r}=centerCurrentCell;document.getElementById("geoUri").innerHTML="geo:"+e.features[0].properties.type+":"+latRound(i,l)+","+latRound(r,l),document.getElementById("fieldencode").value="geo:"+e.features[0].properties.type+":"+latRound(i)+","+latRound(r)+";u="+document.getElementById("level_size").value;var o=uri_base+"/geo:"+e.features[0].properties.type+":"+e.features[0].id;const n="AFA.codes: "+e.features[0].id,a={additionalInformation:"to canonical."};window.history.pushState(a,n,o)}}function loadGeojson(e,t,o,l){fetch(e).then((e=>e.json())).then((e=>{for(t[0].clearLayers(),i=0;i<t.length;i++)"FeatureCollection"===e.type?t[i].addData(e.features):t[i].addData(e);o(t[0]),l(e,t[0]),fixZOrder(overlays)})).catch((e=>{}))}pathname.startsWith("/geo:")&&pathname.match(/^\/geo:[A-Z]{2}-.*?$/i)&&(pathname=pathname.replace(/\/geo:(.*)$/i,"/$1"));const loadGeoApi=(e,t,o,l,i)=>{const r=pathname.match(e);r&&(loadGeojson(pathname.replace(e,`/geo:iso_ext2:${r[1]}${o}`),[layerJurisdAll2],null,null),loadGeojson(pathname.replace(e,`/${t}:${r[1]}${o}`),[layerJurisdAll],l,i))},patterns=[{regex:/\/CO-(\d+)((~|-)[0123456789BCDFGHJKLMNPQRSTUVWXYZ\.]+)?$/i,prefix:"geo:co-divipola",suffix:".json",afterLoad:afterLoadJurisdAll,afterData:afterData},{regex:/\/BR-(\d+)((~|-)[0123456789BCDFGHJKLMNPQRSTUVWXYZ\.]+)?$/i,prefix:"geo:br-geocodigo",suffix:".json",afterLoad:afterLoadJurisdAll,afterData:afterData},{regex:/\/CM-(\d+)((~|-)[0123456789BCDFGHJKLMNPQRSTUVWXYZ\.]+)?$/i,prefix:"geo:cm-code",suffix:".json",afterLoad:afterLoadJurisdAll,afterData:afterData},{regex:/^\/([A-Z]{2}(-[A-Z0-9]+){1,2})((~|-)[0123456789BCDFGHJKLMNPQRSTUVWXYZ\.]+)?$/i,prefix:"geo:iso_ext",suffix:".json",afterLoad:afterLoadJurisdAll,afterData:afterData},{regex:/^\/([A-Z]{2}(-[A-Z0-9]+){1,2})\/geo:(olc|ghs):.+$/i,prefix:"geo:iso_ext",suffix:".json",afterLoad:e=>afterLoadJurisdAll(e,!1),afterData:function(e){}}];if(patterns.forEach((({regex:e,prefix:t,suffix:o,afterLoad:l})=>{loadGeoApi(e,t,o,l,afterData)})),pathname.match(/^(\/[A-Z]{2}(-[A-Z0-9]+){1,2})?\/geo:(olc|ghs):.+$/i))loadGeojson(pathname.replace(/^(\/[A-Z]{2}(-[A-Z0-9]+){1,2})?\/(geo:(olc|ghs):.+)$/i,"/$3.json"),[layerOlcGhsCurrent,layerOlcGhsAll],afterLoadLayer,afterDataOlcGhs);else{let e="";pathname.match(/^\/((([A-Z]{2})-\d+)|([A-Z]{2}((-[A-Z0-9]+){1,2})))(~|-)[0123456789BCDFGHJKLMNPQRSTUVWXYZ\.]+(,[0123456789BCDFGHJKLMNPQRSTUVWXYZ\.]+)*$/i)?(pathname=pathname.replace(/\./g,""),e=pathname.replace(/\/(.+)$/i,"/geo:afa:$1.json")):pathname.match(/^\/geo:.+$/i)&&(e=pathname+".json",getJurisdAfterLoad=!0),""!==e&&loadGeojson(uri_base+e,[layerPolygonCurrent,layerPolygonAll],afterLoadCurrent,afterData)}